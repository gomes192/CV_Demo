{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/samue/OneDrive/Documents/Code/Projetos%20de%20Sites/CV_Demo/components/PeopleCounter.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useRef, useState } from \"react\";\nimport * as cocoSsd from \"@tensorflow-models/coco-ssd\";\nimport \"@tensorflow/tfjs\";\n\ntype DetectionStatus = \"idle\" | \"loading\" | \"running\" | \"error\";\n\nexport function PeopleCounter() {\n  const videoRef = useRef<HTMLVideoElement | null>(null);\n  const canvasRef = useRef<HTMLCanvasElement | null>(null);\n  const [status, setStatus] = useState<DetectionStatus>(\"idle\");\n  const [error, setError] = useState<string | null>(null);\n  const [peopleCount, setPeopleCount] = useState<number>(0);\n  const [faceMode, setFaceMode] = useState<\"user\" | \"environment\">(\n    \"environment\",\n  );\n\n  useEffect(() => {\n    let model: cocoSsd.ObjectDetection | null = null;\n    let animationFrameId: number | null = null;\n    let isCancelled = false;\n\n    async function setupCamera() {\n      try {\n        setStatus(\"loading\");\n\n        const video = videoRef.current;\n        const canvas = canvasRef.current;\n        if (!video || !canvas) return;\n\n        const stream = await navigator.mediaDevices.getUserMedia({\n          video: {\n            facingMode: { ideal: faceMode },\n            width: { ideal: 1280 },\n            height: { ideal: 720 },\n          },\n          audio: false,\n        });\n\n        video.srcObject = stream;\n        await video.play();\n\n        canvas.width = video.videoWidth;\n        canvas.height = video.videoHeight;\n\n        model = await cocoSsd.load({ base: \"lite_mobilenet_v2\" });\n\n        if (isCancelled) {\n          stream.getTracks().forEach((t) => t.stop());\n          return;\n        }\n\n        setStatus(\"running\");\n\n        const ctx = canvas.getContext(\"2d\");\n        if (!ctx) return;\n\n        const detectFrame = async () => {\n          if (!video || !model || video.readyState !== 4) {\n            animationFrameId = requestAnimationFrame(detectFrame);\n            return;\n          }\n\n          try {\n            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n\n            const predictions = await model.detect(canvas, undefined, 0.5);\n            const persons = predictions.filter(\n              (p) => p.class === \"person\" && p.score !== undefined && p.score > 0.6,\n            );\n            setPeopleCount(persons.length);\n\n            ctx.lineWidth = 2;\n            ctx.font = \"14px system-ui, -apple-system, BlinkMacSystemFont, sans-serif\";\n\n            persons.forEach((person) => {\n              const [x, y, width, height] = person.bbox;\n              ctx.strokeStyle = \"#22c55e\";\n              ctx.fillStyle = \"rgba(34, 197, 94, 0.15)\";\n              ctx.fillRect(x, y, width, height);\n              ctx.strokeRect(x, y, width, height);\n\n              const label = `${(person.score ?? 0 * 100).toFixed(0)}% person`;\n              const labelX = x;\n              const labelY = y > 20 ? y - 6 : y + 18;\n\n              ctx.fillStyle = \"rgba(15, 23, 42, 0.9)\";\n              ctx.fillRect(labelX, labelY - 16, ctx.measureText(label).width + 10, 18);\n\n              ctx.fillStyle = \"#e5e7eb\";\n              ctx.fillText(label, labelX + 5, labelY - 3);\n            });\n          } catch (err) {\n            console.error(err);\n          }\n\n          animationFrameId = requestAnimationFrame(detectFrame);\n        };\n\n        detectFrame();\n      } catch (err) {\n        console.error(err);\n        setStatus(\"error\");\n        setError(\n          err instanceof Error\n            ? err.message\n            : \"Failed to start camera or detection.\",\n        );\n      }\n    }\n\n    setupCamera();\n\n    return () => {\n      isCancelled = true;\n\n      if (animationFrameId !== null) {\n        cancelAnimationFrame(animationFrameId);\n      }\n\n      const video = videoRef.current;\n      if (video && video.srcObject instanceof MediaStream) {\n        video.srcObject.getTracks().forEach((t) => t.stop());\n      }\n    };\n  }, [faceMode]);\n\n  const statusLabel =\n    status === \"idle\"\n      ? \"Idle\"\n      : status === \"loading\"\n        ? \"Loading model & camera…\"\n        : status === \"running\"\n          ? \"Counting people in real time\"\n          : \"Error\";\n\n  return (\n    <div className=\"flex h-full flex-col gap-6 lg:flex-row\">\n      <section className=\"flex flex-1 flex-col justify-between rounded-3xl bg-slate-900/60 p-6 ring-1 ring-slate-800/80 backdrop-blur\">\n        <header className=\"flex items-center justify-between gap-4\">\n          <div>\n            <h1 className=\"text-lg font-semibold text-slate-50 sm:text-xl\">\n              Room People Counter\n            </h1>\n            <p className=\"mt-1 text-sm text-slate-400\">\n              Uses on-device computer vision to estimate how many people are in\n              front of your camera.\n            </p>\n          </div>\n          <div className=\"flex items-center gap-3\">\n            <span\n              className={`inline-flex items-center gap-1.5 rounded-full px-3 py-1 text-xs font-medium ${\n                status === \"running\"\n                  ? \"bg-emerald-500/10 text-emerald-300 ring-1 ring-emerald-500/40\"\n                  : status === \"loading\"\n                    ? \"bg-amber-500/10 text-amber-300 ring-1 ring-amber-500/40\"\n                    : status === \"error\"\n                      ? \"bg-rose-500/10 text-rose-300 ring-1 ring-rose-500/40\"\n                      : \"bg-slate-700/60 text-slate-300 ring-1 ring-slate-600/70\"\n              }`}\n            >\n              <span\n                className={`h-1.5 w-1.5 rounded-full ${\n                  status === \"running\"\n                    ? \"bg-emerald-400\"\n                    : status === \"loading\"\n                      ? \"bg-amber-400\"\n                      : status === \"error\"\n                        ? \"bg-rose-400\"\n                        : \"bg-slate-400\"\n                }`}\n              />\n              {statusLabel}\n            </span>\n            <button\n              type=\"button\"\n              onClick={() =>\n                setFaceMode((prev) =>\n                  prev === \"environment\" ? \"user\" : \"environment\",\n                )\n              }\n              className=\"inline-flex items-center gap-1.5 rounded-full bg-slate-800/80 px-3 py-1 text-xs font-medium text-slate-200 ring-1 ring-slate-700 transition hover:bg-slate-700/80 hover:ring-slate-500/80\"\n            >\n              <span className=\"h-1.5 w-1.5 rounded-full bg-cyan-400\" />\n              {faceMode === \"environment\" ? \"Rear camera\" : \"Front camera\"}\n            </button>\n          </div>\n        </header>\n\n        <div className=\"mt-4 flex flex-1 flex-col gap-4 lg:flex-row\">\n          <div className=\"relative flex-1 overflow-hidden rounded-2xl bg-slate-900/80\">\n            <video\n              ref={videoRef}\n              className=\"pointer-events-none absolute inset-0 h-full w-full object-cover opacity-0\"\n              playsInline\n              muted\n            />\n            <canvas\n              ref={canvasRef}\n              className=\"h-[280px] w-full bg-slate-900 object-cover sm:h-[360px] lg:h-full\"\n            />\n            <div className=\"pointer-events-none absolute inset-0 bg-gradient-to-t from-slate-950/60 via-transparent to-slate-950/20\" />\n          </div>\n\n          <aside className=\"flex w-full flex-col justify-between gap-4 rounded-2xl bg-slate-950/60 p-4 ring-1 ring-slate-800/80 lg:w-72\">\n            <div>\n              <p className=\"text-xs font-medium uppercase tracking-[0.2em] text-slate-400\">\n                Live Count\n              </p>\n              <div className=\"mt-2 flex items-end gap-2\">\n                <span className=\"text-6xl font-semibold tabular-nums text-emerald-400 sm:text-7xl\">\n                  {peopleCount}\n                </span>\n                <span className=\"mb-2 text-sm text-slate-400\">\n                  {peopleCount === 1 ? \"person\" : \"people\"}\n                </span>\n              </div>\n              <p className=\"mt-3 text-xs text-slate-400\">\n                This is an estimate based on visible people in the camera\n                frame. Good lighting and clear visibility improve accuracy.\n              </p>\n            </div>\n\n            <div className=\"space-y-2 text-xs text-slate-400\">\n              <p className=\"font-medium text-slate-300\">Tips for best results</p>\n              <ul className=\"space-y-1.5\">\n                <li>• Point the camera so most people are fully visible.</li>\n                <li>• Avoid strong backlight or very dark scenes.</li>\n                <li>• Works entirely in your browser, no video is uploaded.</li>\n              </ul>\n            </div>\n          </aside>\n        </div>\n\n        {status === \"error\" && error && (\n          <p className=\"mt-3 text-xs text-rose-300\">\n            Camera or model error: {error}. Check that you granted camera\n            access and are using a secure (https) connection.\n          </p>\n        )}\n      </section>\n\n      <section className=\"flex w-full flex-col justify-between gap-4 rounded-3xl bg-slate-900/40 p-6 ring-1 ring-slate-800/80 backdrop-blur lg:w-80\">\n        <div>\n          <h2 className=\"text-sm font-semibold text-slate-100\">\n            About this demo\n          </h2>\n          <p className=\"mt-2 text-sm text-slate-400\">\n            This project runs a lightweight TensorFlow.js model\n            (<code className=\"rounded bg-slate-800/80 px-1.5 py-0.5 text-[0.7rem] text-emerald-300\">\n              coco-ssd\n            </code>\n            ) directly in your browser to detect people in the frame, then\n            visualizes them with bounding boxes.\n          </p>\n        </div>\n\n        <div className=\"space-y-3 text-sm text-slate-400\">\n          <div>\n            <p className=\"text-xs font-medium uppercase tracking-[0.18em] text-slate-500\">\n              Designed for\n            </p>\n            <p className=\"mt-1 text-sm text-slate-300\">\n              Desktop & mobile browsers (Chrome, Edge, Safari) with camera\n              access.\n            </p>\n          </div>\n          <div>\n            <p className=\"text-xs font-medium uppercase tracking-[0.18em] text-slate-500\">\n              Privacy\n            </p>\n            <p className=\"mt-1 text-sm text-slate-300\">\n              All computation happens on-device. Video never leaves your\n              browser.\n            </p>\n          </div>\n        </div>\n\n        <div className=\"rounded-2xl border border-dashed border-slate-700/80 bg-slate-950/40 p-3 text-xs text-slate-400\">\n          <p className=\"font-medium text-slate-300\">\n            Deploying to Vercel\n          </p>\n          <ol className=\"mt-1 list-decimal space-y-0.5 pl-4\">\n            <li>Push this folder to a Git repo.</li>\n            <li>Import into Vercel as a Next.js app.</li>\n            <li>Set build command to <code>npm run build</code> and output to <code>.next</code> (defaults).</li>\n          </ol>\n        </div>\n      </section>\n    </div>\n  );\n}\n\n"],"names":[],"mappings":"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"}}]
}